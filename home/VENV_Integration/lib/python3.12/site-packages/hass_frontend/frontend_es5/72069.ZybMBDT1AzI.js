"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[72069],{20712:function(e,t,r){r.d(t,{E:function(){return l}});var a=r(64782),n=r(35806),i=r(71008),s=r(62193),o=r(2816),c=r(27927),u=r(35890),d=(r(81027),r(82386),r(95737),r(39790),r(66457),r(36604),r(253),r(4525),r(96858),r(29818)),l=function(e){var t=(0,c.A)(null,(function(e,t){var r=function(t){function r(){var t;(0,i.A)(this,r);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=(0,s.A)(this,r,[].concat(n)),e(t),t}return(0,o.A)(r,t),(0,n.A)(r)}(t);return{F:r,d:[{kind:"field",decorators:[(0,d.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,u.A)(r,"connectedCallback",this,3)([]),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,u.A)(r,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){var e=this.__unsubs.pop();e instanceof Promise?e.then((function(e){return e()})):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,u.A)(r,"updated",this,3)([e]),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var t,n=(0,a.A)(e.keys());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this.hassSubscribeRequiredHostProps.includes(i))return void this.__checkSubscribed()}}catch(s){n.e(s)}finally{n.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e,t=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((function(e){return void 0===t[e]}))||(this.__unsubs=this.hassSubscribe())}}]}}),e);return t}},23469:function(e,t,r){r.d(t,{g:function(){return i}});r(79641);var a=r(3254),n=r(92164);function i(e,t,r,i,s,o){var c=e.getPropertyValue(s+"-"+o).trim(),u=c.length>0?c:e.getPropertyValue(s).trim(),d=(0,a.RQ)(u);return 0===c.length&&o&&(d=(0,a.v2)((0,a.BE)(t?(0,n.T)((0,a.Nc)((0,a.xp)(d)),o):(0,n.d)((0,a.Nc)((0,a.xp)(d)),o)))),i?d+=r?"32":"7F":r&&(d+="7F"),d}},37334:function(e,t,r){var a=r(22858).A,n=r(33994).A;r.a(e,function(){var e=a(n().mark((function e(a,i){var s,o,c,u,d,l,h,f,v,_,g,y,b;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,b=function(e,t,r,a,n,i,s){var o=(0,u.c)(t,e),c=void 0!==i&&void 0!==s;if(c&&o<=35){var _=(0,d.M)(t,e),g=(0,d.M)(s,i);g>_?t=(0,l.L)(t,g-_):_>g&&(s=(0,l.L)(s,_-g))}var b={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:e.getTime(),max:y(o,t),adapters:{date:{locale:r,config:a}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:o>35?"monthyear":o>7?"date":o>2?"weekday":o>0?"datetime":"hour",minUnit:o>35?"month":o>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:n},ticks:{beginAtZero:!0,callback:function(e){return(0,h.ZV)(Math.abs(e),r)}}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},callbacks:{title:function(e){if(o>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(c?"".concat((0,f.sl)(t,r,a),": "):"").concat((0,v.fU)(t,r,a)," â€“ ").concat((0,v.fU)((0,l.L)(t,1),r,a))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,h.ZV)(e.parsed.y,r)," ").concat(n)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,h.Yf)(r)};return c&&(b.scales.xAxisCompare=Object.assign(Object.assign({},b.scales.x),{},{suggestedMin:i.getTime(),max:y(o,s),display:!1})),b},y=function(e,t){var r=new Date(t);return e>2&&0===r.getHours()&&(r=(0,c.O)(r,1)),r.setMinutes(0,0,0),e>35&&r.setDate(1),e>2&&r.setHours(0),r.getTime()},r.d(t,{o:function(){return b}}),s=r(81027),o=r(26098),c=r(22874),u=r(74312),d=r(56180),l=r(97405),h=r(57636),f=r(57289),v=r(41924),!(_=a([h,f,v])).then){e.next=23;break}return e.next=19,_;case 19:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=24;break;case 23:e.t0=_;case 24:g=e.t0,h=g[0],f=g[1],v=g[2],i(),e.next=34;break;case 31:e.prev=31,e.t2=e.catch(0),i(e.t2);case 34:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,r){return e.apply(this,arguments)}}())},72069:function(e,t,r){var a=r(22858).A,n=r(33994).A;r.a(e,function(){var e=a(n().mark((function e(a,i){var s,o,c,u,d,l,h,f,v,_,g,y,b,p,k,m,x,A,w,O,S,j,C,E,M,D,z,P,H,R,I,q,V,Z,F,N,U,T,L,W,B,G,Q,Y,$,J,K,X,ee,te,re,ae,ne,ie,se,oe,ce,ue,de,le,he;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r.r(t),r.d(t,{HuiEnergyUsageGraphCard:function(){return he}}),s=r(658),o=r(33994),c=r(41981),u=r(22858),d=r(64782),l=r(64599),h=r(35806),f=r(71008),v=r(62193),_=r(2816),g=r(27927),y=r(81027),b=r(13025),p=r(52427),k=r(82386),m=r(95737),x=r(89655),A=r(33231),w=r(29193),O=r(26098),S=r(99471),j=r(10507),C=r(39790),E=r(9241),M=r(74268),D=r(24545),z=r(51855),P=r(82130),H=r(31743),R=r(22328),I=r(4959),q=r(62435),V=r(99019),Z=r(253),F=r(2075),N=r(54846),U=r(4525),T=r(66555),L=r(96858),W=r(34953),B=r(59298),G=r(28514),Q=r(15112),Y=r(29818),$=r(85323),J=r(94100),K=r(23469),X=r(57636),r(90701),r(13082),ee=r(47076),te=r(4826),re=r(20712),ae=r(7934),ne=r(37334),!(ie=a([X,ee,ne])).then){e.next=94;break}return e.next=90,ie;case 90:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=95;break;case 94:e.t0=ie;case 95:se=e.t0,X=se[0],ee=se[1],ne=se[2],le={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},he=(0,g.A)([(0,Y.EM)("hui-energy-usage-graph-card")],(function(e,t){var r,a=function(t){function r(){var t;(0,f.A)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return t=(0,v.A)(this,r,[].concat(n)),e(t),t}return(0,_.A)(r,t),(0,h.A)(r)}(t);return{F:a,d:[{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,Y.wk)()],key:"_start",value:function(){return(0,W.R)()}},{kind:"field",decorators:[(0,Y.wk)()],key:"_end",value:function(){return(0,B.o)()}},{kind:"field",decorators:[(0,Y.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,ee.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,ae.xP)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,Q.qy)(oe||(oe=(0,l.A)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,Q.qy)(ce||(ce=(0,l.A)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,$.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((function(e){return e.data.length}))?"":(0,Q.qy)(ue||(ue=(0,l.A)(['<div class="no-data"> '," </div>"])),(0,G.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):Q.s6}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,J.A)((function(t,r,a,n,i,s){var o=(0,ne.o)(t,r,a,n,"kWh",i,s),c=Object.assign(Object.assign({},o),{},{plugins:Object.assign(Object.assign({},o.plugins),{},{tooltip:Object.assign(Object.assign({},o.plugins.tooltip),{},{itemSort:function(e,t){var r,a,n,i,s;return(null===(r=e.raw)||void 0===r?void 0:r.y)>0&&(null===(a=t.raw)||void 0===a?void 0:a.y)<0?-1:(null===(n=t.raw)||void 0===n?void 0:n.y)>0&&(null===(i=e.raw)||void 0===i?void 0:i.y)<0?1:(null===(s=e.raw)||void 0===s?void 0:s.y)>0?t.datasetIndex-e.datasetIndex:e.datasetIndex-t.datasetIndex},callbacks:Object.assign(Object.assign({},o.plugins.tooltip.callbacks),{},{footer:function(t){var r,n=0,i=0,s=(0,d.A)(t);try{for(s.s();!(r=s.n()).done;){var o=r.value,c=o.dataset.data[o.dataIndex].y;c>0?n+=c:i+=Math.abs(c)}}catch(u){s.e(u)}finally{s.f()}return[n?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,X.ZV)(n,a)}):"",i?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,X.ZV)(i,a)}):""].filter(Boolean)}})})})});return c}))}},{kind:"method",key:"_getStatistics",value:(r=(0,u.A)((0,o.A)().mark((function e(t){var r,a,n,i,s,u,l,h,f,v,_,g,y,b;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a={},n=(0,d.A)(t.prefs.energy_sources),e.prev=3,n.s();case 5:if((i=n.n()).done){e.next=21;break}if("solar"!==(s=i.value).type){e.next=10;break}return a.solar?a.solar.push(s.stat_energy_from):a.solar=[s.stat_energy_from],e.abrupt("continue",19);case 10:if("battery"!==s.type){e.next=13;break}return a.to_battery?(a.to_battery.push(s.stat_energy_to),a.from_battery.push(s.stat_energy_from)):(a.to_battery=[s.stat_energy_to],a.from_battery=[s.stat_energy_from]),e.abrupt("continue",19);case 13:if("grid"===s.type){e.next=15;break}return e.abrupt("continue",19);case 15:u=(0,d.A)(s.flow_from);try{for(u.s();!(l=u.n()).done;)h=l.value,a.from_grid?a.from_grid.push(h.stat_energy_from):a.from_grid=[h.stat_energy_from]}catch(o){u.e(o)}finally{u.f()}f=(0,d.A)(s.flow_to);try{for(f.s();!(v=f.n()).done;)_=v.value,a.to_grid?a.to_grid.push(_.stat_energy_to):a.to_grid=[_.stat_energy_to]}catch(o){f.e(o)}finally{f.f()}case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),n.e(e.t0);case 26:return e.prev=26,n.f(),e.finish(26);case 29:g=getComputedStyle(this),y={},Object.keys(le).forEach((function(e){y[e]={},"used_grid"!==e&&"used_solar"!==e&&"used_battery"!==e&&a[e]&&Object.values(a[e]).forEach((function(t,r){y[e][t]=r}))})),b={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=t.start,this._end=t.end||(0,B.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,r.push.apply(r,(0,c.A)(this._processDataSet(t.stats,t.statsMetadata,a,y,g,b,!1))),t.statsCompare&&(r.push({order:0,data:[]}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),r.push.apply(r,(0,c.A)(this._processDataSet(t.statsCompare,t.statsMetadata,a,y,g,b,!0)))),this._chartData={datasets:r};case 40:case"end":return e.stop()}}),e,this,[[3,23,26,29]])}))),function(e){return r.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,r,a,n,i){var o,c=this,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=[],h={},f={};Object.entries(r).forEach((function(t){var r=(0,s.A)(t,2),a=r[0],n=r[1],i=["solar","to_grid","from_grid","to_battery","from_battery"].includes(a),c=!["solar","from_battery"].includes(a),u={},d={};n.forEach((function(t){var r=e[t];if(r){var a={};r.forEach((function(e){if(null!==e.change&&void 0!==e.change){var t=e.change;i&&(u[e.start]=e.start in u?u[e.start]+t:t,o=e.end),c&&!(e.start in a)&&(a[e.start]=t,o=e.end)}})),d[t]=a}})),i&&(f[a]=u),c&&(h[a]=d)}));var v={},_={};if((f.to_grid||f.to_battery)&&f.solar){for(var g={},y=0,b=Object.keys(f.solar);y<b.length;y++){var p,k,m=b[y];if(g[m]=(f.solar[m]||0)-((null===(p=f.to_grid)||void 0===p?void 0:p[m])||0)-((null===(k=f.to_battery)||void 0===k?void 0:k[m])||0),g[m]<0){var x,A,w;if(f.to_battery)if(v[m]=-1*g[m],v[m]>((null===(x=f.from_grid)||void 0===x?void 0:x[m])||0))_[m]=v[m]-((null===(A=f.from_grid)||void 0===A?void 0:A[m])||0),v[m]=null===(w=f.from_grid)||void 0===w?void 0:w[m];g[m]=0}}h.used_solar={used_solar:g}}if(f.from_battery)if(f.to_grid){for(var O={},S=0,j=Object.keys(f.from_battery);S<j.length;S++){var C=j[S];O[C]=(f.from_battery[C]||0)-(_[C]||0)}h.used_battery={used_battery:O}}else h.used_battery={used_battery:f.from_battery};if(h.from_grid&&f.to_battery){for(var E={},M=function(){for(var e,t=z[D],r=0,a=0,n=Object.entries(h.from_grid);a<n.length;a++){var i=(0,s.A)(n[a],2),o=i[0];if(i[1][t]&&(e=o,r++),r>1)break}if(1===r)h.from_grid[e][t]-=v[t]||0;else{var c=0;Object.values(h.from_grid).forEach((function(e){c+=e[t]||0,delete e[t]})),E[t]=c-(v[t]||0)}},D=0,z=Object.keys(v);D<z.length;D++)M();h.used_grid={used_grid:E}}var P=[];Object.values(h).forEach((function(e){Object.values(e).forEach((function(e){P=P.concat(Object.keys(e))}))}));var H=Array.from(new Set(P)).sort((function(e,t){return Number(e)-Number(t)}));return Object.entries(h).forEach((function(e){var r=(0,s.A)(e,2),f=r[0],v=r[1];Object.entries(v).forEach((function(e,r){var v,_,g,y=(0,s.A)(e,2),b=y[0],p=y[1],k=[],m=(0,d.A)(H);try{for(m.s();!(g=m.n()).done;){var x=g.value,A=p[x]||0;k.push({x:Number(x),y:A&&["to_grid","to_battery"].includes(f)?-1*A:A})}}catch(w){m.e(w)}finally{m.f()}1===k.length&&k.push({x:o,y:0}),l.push({label:f in i?i[f]:(0,te.$O)(c.hass,b,t[b]),order:"used_solar"===f?1:"to_battery"===f?Object.keys(h).length:r+2,borderColor:(0,K.g)(n,c.hass.themes.darkMode,!1,u,le[f],null===(v=a[f])||void 0===v?void 0:v[b]),backgroundColor:(0,K.g)(n,c.hass.themes.darkMode,!0,u,le[f],null===(_=a[f])||void 0===_?void 0:_[b]),stack:"stack",data:k,xAxisID:u?"xAxisCompare":void 0})}))})),l}},{kind:"get",static:!0,key:"styles",value:function(){return(0,Q.AH)(de||(de=(0,l.A)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"])))}}]}}),(0,re.E)(Q.WF)),i(),e.next=107;break;case 104:e.prev=104,e.t2=e.catch(0),i(e.t2);case 107:case"end":return e.stop()}}),e,null,[[0,104]])})));return function(t,r){return e.apply(this,arguments)}}())},78276:function(e,t,r){r.d(t,{A:function(){return n}});var a=r(76270);function n(e){return(0,a.w)(e,Date.now())}},78635:function(e,t,r){r.d(t,{r:function(){return s}});var a=r(658),n=r(52142),i=r(23566);function s(e,t,r){var s=(0,n.x)(null==r?void 0:r.in,e,t),o=(0,a.A)(s,2),c=o[0],u=o[1];return+(0,i.o)(c)==+(0,i.o)(u)}},28514:function(e,t,r){r.d(t,{c:function(){return s}});var a=r(76270),n=r(78276),i=r(78635);function s(e,t){return(0,i.r)((0,a.w)((null==t?void 0:t.in)||e,e),(0,n.A)((null==t?void 0:t.in)||e))}}}]);
//# sourceMappingURL=72069.ZybMBDT1AzI.js.map