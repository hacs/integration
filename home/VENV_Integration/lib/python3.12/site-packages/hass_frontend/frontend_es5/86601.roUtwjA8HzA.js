"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[86601],{29136:function(e,t,i){i.d(t,{H:function(){return r},R:function(){return s}});i(26098);var s=function(e,t,i){return e.subscribeMessage((function(e){return t(e)}),Object.assign({type:"render_template"},i))},r=function(e,t,i,s,r){return e.connection.subscribeMessage(r,{type:"template/start_preview",flow_id:t,flow_type:i,user_input:s})}},86601:function(e,t,i){var s=i(22858).A,r=i(33994).A;i.a(e,function(){var e=s(r().mark((function e(s,n){var a,l,o,u,d,c,h,p,_,v,f,k,b,w,y,m,g,A,x,q,M,z,P,I,Z,C,D,S;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i.r(t),a=i(33994),l=i(22858),o=i(64599),u=i(35806),d=i(71008),c=i(62193),h=i(2816),p=i(27927),_=i(35890),v=i(81027),f=i(97741),k=i(33231),b=i(16891),w=i(15112),y=i(29818),m=i(18409),g=i(29136),A=i(34944),x=i(34897),!(q=s([A])).then){e.next=33;break}return e.next=29,q;case 29:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=34;break;case 33:e.t0=q;case 34:A=e.t0[0],(0,p.A)([(0,y.EM)("flow-preview-template")],(function(e,t){var i,s=function(t){function i(){var t;(0,d.A)(this,i);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return t=(0,c.A)(this,i,[].concat(r)),e(t),t}return(0,h.A)(i,t),(0,u.A)(i)}(t);return{F:s,d:[{kind:"field",decorators:[(0,y.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,y.MZ)()],key:"flowType",value:void 0},{kind:"field",key:"handler",value:void 0},{kind:"field",decorators:[(0,y.MZ)()],key:"stepId",value:void 0},{kind:"field",decorators:[(0,y.MZ)()],key:"flowId",value:void 0},{kind:"field",decorators:[(0,y.MZ)({attribute:!1})],key:"stepData",value:void 0},{kind:"field",decorators:[(0,y.wk)()],key:"_preview",value:void 0},{kind:"field",decorators:[(0,y.wk)()],key:"_listeners",value:void 0},{kind:"field",decorators:[(0,y.wk)()],key:"_error",value:void 0},{kind:"field",key:"_unsub",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,_.A)(s,"disconnectedCallback",this,3)([]),this._unsub&&(this._unsub.then((function(e){return e()})),this._unsub=void 0)}},{kind:"method",key:"willUpdate",value:function(e){e.has("stepData")&&this._debouncedSubscribePreview()}},{kind:"method",key:"render",value:function(){var e,t=this;return this._error?(0,w.qy)(M||(M=(0,o.A)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,w.qy)(z||(z=(0,o.A)(['<entity-preview-row .hass="','" .stateObj="','"></entity-preview-row> '," "," "])),this.hass,this._preview,null!==(e=this._listeners)&&void 0!==e&&e.time?(0,w.qy)(P||(P=(0,o.A)([" <p> "," </p> "])),this.hass.localize("ui.dialogs.helper_settings.template.time")):w.s6,this._listeners?this._listeners.all?(0,w.qy)(I||(I=(0,o.A)([' <p class="all_listeners"> '," </p> "])),this.hass.localize("ui.dialogs.helper_settings.template.all_listeners")):this._listeners.domains.length||this._listeners.entities.length?(0,w.qy)(Z||(Z=(0,o.A)([" <p> "," </p> <ul> "," "," </ul> "])),this.hass.localize("ui.dialogs.helper_settings.template.listeners"),this._listeners.domains.sort().map((function(e){return(0,w.qy)(C||(C=(0,o.A)([" <li> <b>","</b>: "," </li> "])),t.hass.localize("ui.dialogs.helper_settings.template.domain"),e)})),this._listeners.entities.sort().map((function(e){return(0,w.qy)(D||(D=(0,o.A)([" <li> <b>","</b>: "," </li> "])),t.hass.localize("ui.dialogs.helper_settings.template.entity"),e)}))):this._listeners.time?w.s6:(0,w.qy)(S||(S=(0,o.A)(['<p class="all_listeners"> '," </p>"])),this.hass.localize("ui.dialogs.helper_settings.template.no_listeners")):w.s6)}},{kind:"field",key:"_setPreview",value:function(){var e=this;return function(t){if("error"in t)return e._error=t.error,void(e._preview=void 0);e._error=void 0,e._listeners=t.listeners;var i=(new Date).toISOString();e._preview={entity_id:"".concat(e.stepId,".___flow_preview___"),last_changed:i,last_updated:i,context:{id:"",parent_id:null,user_id:null},attributes:t.attributes,state:t.state}}}},{kind:"field",key:"_debouncedSubscribePreview",value:function(){var e=this;return(0,m.s)((function(){e._subscribePreview()}),250)}},{kind:"method",key:"_subscribePreview",value:(i=(0,l.A)((0,a.A)().mark((function e(){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._unsub){e.next=6;break}return e.next=3,this._unsub;case 3:e.t0=e.sent,(0,e.t0)(),this._unsub=void 0;case 6:if("repair_flow"!==this.flowType){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,this._unsub=(0,g.H)(this.hass,this.flowId,this.flowType,this.stepData,this._setPreview),e.next=12,this._unsub;case 12:(0,x.r)(this,"set-flow-errors",{errors:{}}),e.next=20;break;case 15:e.prev=15,e.t1=e.catch(8),"string"==typeof e.t1.message?this._error=e.t1.message:(this._error=void 0,(0,x.r)(this,"set-flow-errors",e.t1.message)),this._unsub=void 0,this._preview=void 0;case 20:case"end":return e.stop()}}),e,this,[[8,15]])}))),function(){return i.apply(this,arguments)})}]}}),w.WF),n(),e.next=42;break;case 39:e.prev=39,e.t2=e.catch(0),n(e.t2);case 42:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t,i){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=86601.roUtwjA8HzA.js.map