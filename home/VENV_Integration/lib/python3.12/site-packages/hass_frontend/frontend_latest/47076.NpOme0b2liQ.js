export const id=47076;export const ids=[47076];export const modules={78691:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{EO:()=>l,ol:()=>c,xo:()=>_});var r=o(35193),s=o(45269),a=e([r]);r=(a.then?(await a)():a)[0];const i=(e,t,o,n)=>{const s=o((0,r.L_)(e,t),n);return s instanceof Date?(0,r.uk)(s,t):s},c=(e,t,o,n,r)=>o.time_zone===s.Wj.server?i(e,n.time_zone,t,r):t(e,r),_=(e,t,o,n,r)=>o.time_zone===s.Wj.server?i(e,n.time_zone,t,r):t(e,r),l=(e,t,o,n,a)=>_(e,o,n,a,n.time_zone===s.Wj.server?(0,r.L_)(t,a.time_zone):t);n()}catch(e){n(e)}}))},10469:(e,t,o)=>{o.d(t,{$:()=>n});o(89655);const n=(e,t)=>{const o={};for(const n of e){const e=t(n);e in o?o[e].push(n):o[e]=[n]}return o}},31265:(e,t,o)=>{o.d(t,{JW:()=>g,TC:()=>s,VN:()=>a,Vx:()=>i,XQ:()=>f,eM:()=>_,iH:()=>c,k3:()=>y,m4:()=>n,qf:()=>r,yv:()=>l});o(253),o(2075),o(94438);const n=33524==o.j?["migration_error","setup_error","setup_retry"]:null,r=33524==o.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(e,t,o)=>{const n={type:"config_entries/subscribe"};return o&&o.type&&(n.type_filter=o.type),e.connection.subscribeMessage((e=>t(e)),n)},a=(e,t)=>{const o={};return t&&(t.type&&(o.type_filter=t.type),t.domain&&(o.domain=t.domain)),e.callWS({type:"config_entries/get",...o})},i=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),c=(e,t,o)=>e.callWS({type:"config_entries/update",entry_id:t,...o}),_=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),l=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),f=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),y=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),g=(e,t)=>{if(!t)return e;const o=e.find((e=>e.entry_id===t));if(!o)return e;return[o,...e.filter((e=>e.entry_id!==t))]}},47076:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{AN:()=>M,B2:()=>z,BV:()=>j,DR:()=>G,E$:()=>A,GW:()=>P,KJ:()=>I,Q4:()=>E,RB:()=>D,WN:()=>x,X4:()=>K,_d:()=>q,al:()=>H,bs:()=>O,c:()=>C,gv:()=>Q,m7:()=>W,oU:()=>k,tb:()=>V,uh:()=>S,yM:()=>J});o(89655),o(253),o(54846),o(16891);var r=o(74312),s=o(40102),a=o(76476),i=o(56235),c=o(7792),_=o(46091),l=o(34542),f=o(23566),y=o(31077),g=o(97405),u=o(88444),m=o(94100),p=o(78691),d=o(41924),h=o(10469),b=o(31265),w=o(4826),v=e([p,d]);[p,d]=v.then?(await v)():v;const T=[],W=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),D=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),S=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),E=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),k=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),C=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),P=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),j=e=>e.callWS({type:"energy/info"}),z=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),O=e=>e.callWS({type:"energy/get_prefs"}),x=async(e,t)=>{const o=e.callWS({type:"energy/save_prefs",...t});return B(e),o},L=async(e,t,o,n,r,s="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:r?.toISOString(),energy_statistic_ids:o,co2_statistic_id:n,period:s}),A=e=>(0,h.$)(e.energy_sources,(e=>e.type)),M=(e,t,o)=>{const n=[];for(const r of e.energy_sources)if(!o||o.includes(r.type))if("solar"!==r.type)if("gas"!==r.type&&"water"!==r.type)if("battery"!==r.type){for(const e of r.flow_from){n.push(e.stat_energy_from),e.stat_cost&&n.push(e.stat_cost);const o=t.cost_sensors[e.stat_energy_from];o&&n.push(o)}for(const e of r.flow_to){n.push(e.stat_energy_to),e.stat_compensation&&n.push(e.stat_compensation);const o=t.cost_sensors[e.stat_energy_to];o&&n.push(o)}}else n.push(r.stat_energy_from),n.push(r.stat_energy_to);else{n.push(r.stat_energy_from),r.stat_cost&&n.push(r.stat_cost);const e=t.cost_sensors[r.stat_energy_from];e&&n.push(e)}else n.push(r.stat_energy_from);return o&&!o.includes("device")||n.push(...e.device_consumption.map((e=>e.stat_consumption))),n},$=async(e,t,o,n,f)=>{const[y,g]=await Promise.all([(0,b.VN)(e,{domain:"co2signal"}),j(e)]),u=y.length?y[0]:void 0;let m;if(u)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const o=e.states[t.entity_id];if(o&&"%"===o.attributes.unit_of_measurement){m=o.entity_id;break}}const d=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)d.push(t.stat_energy_from);const h=M(t,g,["grid","solar","battery","gas","device"]),v=M(t,g,["water"]),T=[...h,...v],W=(0,r.c)(n||new Date,o),D=W>35?"month":W>2?"day":"hour",S=e.config.unit_system.length||"",E={energy:"kWh",volume:"km"===S?"m続":"ft続"},k={volume:"km"===S?"L":"gal"},C=h.length?(0,w.sz)(e,o,n,h,D,E,["change"]):{},P=v.length?(0,w.sz)(e,o,n,v,D,k,["change"]):{};let z,O,x,A,$,B={},N={};f&&(O=(0,p.xo)(o,s.e,e.locale,e.config)&&(0,p.xo)(n||new Date,a.c,e.locale,e.config)?(0,p.ol)(o,i.P,e.locale,e.config,-(0,p.EO)(n||new Date,o,c.W,e.locale,e.config)-1):(0,p.ol)(o,_.f,e.locale,e.config,-1*(W+1)),x=(0,l.A)(o,-1),h.length&&(B=(0,w.sz)(e,O,x,h,D,E,["change"])),v.length&&(N=(0,w.sz)(e,O,x,v,D,k,["change"]))),void 0!==m&&(A=L(e,o,d,m,n,W>35?"month":W>2?"day":"hour"),f&&($=L(e,O,d,m,x,W>35?"month":W>2?"day":"hour")));const V={},H=T.length?(0,w.Wr)(e,T):[],[X,q,I,J,K,Q,R]=await Promise.all([C,P,B,N,H,A,$]),G={...X,...q};f&&(z={...I,...J}),T.length&&K.forEach((e=>{V[e.statistic_id]=e}));return{start:o,end:n,startCompare:O,endCompare:x,info:g,prefs:t,stats:G,statsMetadata:V,statsCompare:z,co2SignalConfigEntry:u,co2SignalEntity:m,fossilEnergyConsumption:Q,fossilEnergyConsumptionCompare:R}},B=e=>{T.forEach((t=>{const o=V(e,{key:t});o.clearPrefs(),o._active&&o.refresh()}))},N=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},V=(e,t={})=>{let o="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");o=`_${t.key}`}if(e.connection[o])return e.connection[o];T.push(t.key);const n=(0,u.X)(e.connection,o,(async()=>(n.prefs||(n.prefs=await O(e)),N(n),$(e,n.prefs,n.start,n.end,n.compare)))),r=n.subscribe;n.subscribe=e=>{const t=r(e);return n._active++,void 0===n._refreshTimeout&&N(n),()=>{n._active--,n._active<1&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=void 0),t()}},n._active=0,n.prefs=t.prefs;const s=new Date,a=(0,d.LW)(s,e.locale,e.config).split(":")[0];n.start=(0,p.ol)("0"===a?(0,_.f)(s,-1):s,f.o,e.locale,e.config),n.end=(0,p.ol)("0"===a?(0,_.f)(s,-1):s,y.D,e.locale,e.config);const i=()=>{n._updatePeriodTimeout=window.setTimeout((()=>{n.start=(0,p.ol)(new Date,f.o,e.locale,e.config),n.end=(0,p.ol)(new Date,y.D,e.locale,e.config),i()}),(0,g.L)((0,p.ol)(s,y.D,e.locale,e.config),1).getTime()-Date.now())};return i(),n.clearPrefs=()=>{n.prefs=void 0},n.setPeriod=(t,o)=>{n.start=t,n.end=o,n.start.getTime()!==(0,p.ol)(new Date,f.o,e.locale,e.config).getTime()||n.end?.getTime()!==(0,p.ol)(new Date,y.D,e.locale,e.config).getTime()||n._updatePeriodTimeout?n._updatePeriodTimeout&&(clearTimeout(n._updatePeriodTimeout),n._updatePeriodTimeout=void 0):i()},n.setCompare=e=>{n.compare=e},n},H=e=>e.callWS({type:"energy/solar_forecast"}),X=["volume","energy"],q=(e,t={},o)=>{for(const n of e.energy_sources){if("gas"!==n.type)continue;if(o&&o===n.stat_energy_from)continue;const e=t[n.stat_energy_from];if(X.includes(e?.unit_class))return e.unit_class}},I=(e,t,o={})=>{const n=q(t,o);if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},J=e=>"km"===e.config.unit_system.length?"L":"gal",K="/docs/energy/faq/#troubleshooting-missing-entities",Q=(0,m.A)((e=>({summedData:R(e),compareSummedData:e.statsCompare?R(e,!0):void 0}))),R=(e,t)=>{const o={};for(const t of e.prefs.energy_sources)if("solar"!==t.type)if("battery"!==t.type){if("grid"===t.type){for(const e of t.flow_from)o.from_grid?o.from_grid.push(e.stat_energy_from):o.from_grid=[e.stat_energy_from];for(const e of t.flow_to)o.to_grid?o.to_grid.push(e.stat_energy_to):o.to_grid=[e.stat_energy_to]}}else o.to_battery?(o.to_battery.push(t.stat_energy_to),o.from_battery.push(t.stat_energy_from)):(o.to_battery=[t.stat_energy_to],o.from_battery=[t.stat_energy_from]);else o.solar?o.solar.push(t.stat_energy_from):o.solar=[t.stat_energy_from];const n={};return Object.entries(o).forEach((([o,r])=>{const s={},a={};r.forEach((o=>{const n=t?e.statsCompare[o]:e.stats[o];if(!n)return;n.forEach((e=>{if(null===e.change||void 0===e.change)return;const t=e.change;s[e.start]=e.start in s?s[e.start]+t:t})),a[o]={}})),n[o]=s})),n},G=(0,m.A)(((e,t)=>({consumption:U(e),compareConsumption:t?U(t):void 0}))),U=e=>{const t={total:{}};return Object.keys(e).forEach((o=>{Object.keys(e[o]).forEach((o=>{if(void 0===t.total[o]){const n=(e.from_grid?.[o]||0)+(e.solar?.[o]||0)+(e.from_battery?.[o]||0)-(e.to_grid?.[o]||0)-(e.to_battery?.[o]||0);t.total[o]=n}}))})),t};n()}catch(e){n(e)}}))}};
//# sourceMappingURL=47076.NpOme0b2liQ.js.map